name: Install Git Smoke

on:
  workflow_dispatch:
  schedule:
    - cron: "0 6 * * *" # daily

jobs:
  install-git-smoke:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout installer
        uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4

      - name: Build git smoke image
        run: docker build -t coderclaw-install-git-smoke:ci -f scripts/docker/install-sh-git-smoke/Dockerfile . --build-arg LANDING_DIR=landing

      - name: Run git smoke
        env:
          CODERCLAW_NO_ONBOARD: "1"
          CODERCLAW_NO_PROMPT: "1"
        run: docker run --rm -t -e CODERCLAW_NO_ONBOARD -e CODERCLAW_NO_PROMPT coderclaw-install-git-smoke:ci

  install-cli-git-smoke:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout installer
        uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4

      - name: Build git smoke image (install-cli.sh)
        run: docker build -t coderclaw-install-cli-git-smoke:ci -f scripts/docker/install-cli-git-smoke/Dockerfile . --build-arg LANDING_DIR=landing

      - name: Run git smoke (install-cli.sh)
        run: docker run --rm -t coderclaw-install-cli-git-smoke:ci
